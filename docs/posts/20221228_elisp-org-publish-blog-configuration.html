<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elisp Org-Publish Configuration</title>
<meta name="author" content="Lamprinos Chatziioannou" />
<meta name="generator" content="Org Mode" />
<link rel="preconnect" href="https://fonts.googleapis.com"><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap"rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap"rel="stylesheet"><script src="https://cdn.jsdelivr.net/gh/oyvindstegard/ox-tagfilter-js/ox-tagfilter.js"></script><link rel="stylesheet" href="/src/rougier.css" />
    <link rel="icon" type="image/x-icon" href="/src/favicon.ico"><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="./index.html"> UP </a>
 |
 <a accesskey="H" href="/index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Elisp Org-Publish Configuration</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3cd5649">Getting the gist</a></li>
<li><a href="#org7be3c75">Site-wide Variables</a>
<ul>
<li><a href="#orgf1d854b">Content directories</a></li>
<li><a href="#org6d7f127">CSS Path</a></li>
<li><a href="#orgafe1552">Head HTML</a></li>
<li><a href="#org1ad92b3">Postamble</a></li>
<li><a href="#org9341af6">Org-static-blog index variables</a></li>
</ul>
</li>
<li><a href="#org9981630">Package Settings&#xa0;&#xa0;&#xa0;<span class="tag"><span class="restructure">restructure</span></span></a></li>
<li><a href="#orgede8ad2">Org To Html Settings</a></li>
<li><a href="#orgbec7727">Babel</a></li>
<li><a href="#orgda404c1">Series next/before links&#xa0;&#xa0;&#xa0;<span class="tag"><span class="INACTIVE">INACTIVE</span></span></a></li>
<li><a href="#orgd1ca1da">Tips:</a></li>
<li><a href="#org596701f">Project Alist</a>
<ul>
<li>
<ul>
<li><a href="#org0f03d6f">The Brief</a></li>
<li><a href="#org661521e">Summing up</a></li>
</ul>
</li>
<li><a href="#orgbe9b6f3">Org-files</a></li>
<li><a href="#orgfafc83e">Blog-posts</a></li>
<li><a href="#orgf461f45">Images</a></li>
<li><a href="#orgd41e81a">Static</a></li>
</ul>
</li>
<li><a href="#org15468c6">The End - Taking Action</a></li>
<li><a href="#orgd9732e4">Org-static-blog for index creation</a></li>
<li><a href="#org0a2bf19">Sources of inspiration</a></li>
</ul>
</div>
</div>
<p>
Before getting in greater depth: Huge thanks to an extraordinary member of the
Emacs community, whose (live) videos on YouTube, greatly helped me when I
decided to&#x2026; turn evil: David Wilson of <a href="https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/">System Crafters</a>
</p>

<p>
In fact, this configuration is fully based on the one he presented on his
YouTube <a href="https://www.youtube.com/c/SystemCrafters">channel</a>.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">build-site.el -- Summary</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">WARNING: DO NOT EDIT THIS FILE. The elisp file should not be edited. Visit</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">content/posts/20221228_elisp-org-publish-blog-configuration.org instead</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">This is a configuration file for emacs to produce html code for my personal</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">website from plain org mode files. To achieve this I utilize the included</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">ox-publish</span></span><span class="org-comment">' package as well as `</span><span class="org-comment"><span class="org-constant">htmlize</span></span><span class="org-comment">' (even though I can not understand</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">why it does not behave as I would like it to ) and parts of</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">org-static-blog</span></span><span class="org-comment">'</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">WARNING: DO NOT EDIT THIS FILE. The elisp file should not be edited. Visit</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">20221228_elisp-org-publish-blog-configuration.org instead</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">Yup, it is needed twice to make sure I'll read it.</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:</span>
<span class="org-comment-delimiter">;;;; </span><span class="org-comment">TODO Someday I will write something here. Till then ;)</span>


<span class="org-comment-delimiter">;;;; </span><span class="org-comment">I changed/restructured quite some stuff after having a look at:</span>
<span class="org-comment-delimiter">;;;; </span><span class="org-comment">https://her.esy.fun/posts/0001-new-blog/index.html</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:</span>
<span class="org-comment-delimiter">;;;; </span><span class="org-comment">Only to stop flycheck </span>

</pre>
</div>


<div id="outline-container-org3cd5649" class="outline-2">
<h2 id="org3cd5649"><a href="#org3cd5649">Getting the gist</a></h2>
<div class="outline-text-2" id="text-org3cd5649">
<p>
This is a literate configuration file, setting up and emacs instance to be run
on a simple virtual machine (Github actions). As such, you will not see most of
the options one cares for when setting up emacs. If you look at <a href="https://github.com/chatziiola/chatziiola.github.io">my shell script</a>,
you can see that I run emacs as <i>cleanly</i> as possible:
</p>

<div class="org-src-container">
<pre class="src src-shell">emacs -Q --script build-site.el
</pre>
</div>
</div>
</div>

<div id="outline-container-org7be3c75" class="outline-2">
<h2 id="org7be3c75"><a href="#org7be3c75">Site-wide Variables</a></h2>
<div class="outline-text-2" id="text-org7be3c75">
<p>
In this section of the configuration file I initialize the variables that I use
in the rest of the script. The goal here is to have no hard coded paths and/or
settings, and instead, rely on the modification of predefined variables to
change the behavior of already implemented features.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">domainname</span> <span class="org-string">"https://blog.chatziiola.live"</span>
  <span class="org-doc">"Self-Descriptive. It is the address for which we build our site"</span>)
</pre>
</div>
</div>

<div id="outline-container-orgf1d854b" class="outline-3">
<h3 id="orgf1d854b"><a href="#orgf1d854b">Content directories</a></h3>
<div class="outline-text-3" id="text-orgf1d854b">
<p>
To keep it simple:
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">base-dir</span> <span class="org-string">"./content/"</span>
  <span class="org-doc">"The content directory."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">public-dir</span> <span class="org-string">"./public/"</span>
  <span class="org-doc">"The root directory of our webserver."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">drafts-dir</span> (concat base-dir <span class="org-string">"drafts/"</span>)
  <span class="org-doc">"To be ignored when publishing."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">posts-dir</span> (expand-file-name <span class="org-string">"posts/"</span> base-dir)
  <span class="org-doc">"Subfolder of content where posts lie."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">posts-public-dir</span> (expand-file-name <span class="org-string">"posts/"</span> public-dir)
  <span class="org-doc">"The public subfolder in which posts will be published."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">src-dir</span> <span class="org-string">"./content/src/"</span>
  <span class="org-doc">"Self-descriptive."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">src-public-dir</span> <span class="org-string">"./public/src/"</span>
  <span class="org-doc">"Self-descriptive."</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org6d7f127" class="outline-3">
<h3 id="org6d7f127"><a href="#org6d7f127">CSS Path</a></h3>
<div class="outline-text-3" id="text-org6d7f127">
<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">css-path</span> <span class="org-string">"/src/rougier.css"</span>
  <span class="org-doc">"Self-descriptive."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgafe1552" class="outline-3">
<h3 id="orgafe1552"><a href="#orgafe1552">Head HTML</a></h3>
<div class="outline-text-3" id="text-orgafe1552">
<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">org-blog-head</span>
  (concat
   <span class="org-string">"&lt;link rel=\"preconnect\" href=\"https://fonts.googleapis.com\"&gt;"</span>
   <span class="org-string">"&lt;link href=\"https://fonts.googleapis.com/css2?family=Fira+Sans&amp;display=swap\"rel=\"stylesheet\"&gt;"</span>
   <span class="org-string">"&lt;link href=\"https://fonts.googleapis.com/css2?family=Roboto+Condensed&amp;display=swap\"rel=\"stylesheet\"&gt;"</span>
   <span class="org-string">"&lt;link rel=\"stylesheet\" href=\""</span> css-path <span class="org-string">"\" /&gt;</span>
<span class="org-string">    &lt;link rel=\"icon\" type=\"image/x-icon\" href=\"/src/favicon.ico\"&gt;"</span>
   <span class="org-string">"&lt;meta charset=\"UTF-8\" name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;"</span>
   )
  <span class="org-doc">"Description - BLOG HTML HEAD."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ad92b3" class="outline-3">
<h3 id="org1ad92b3"><a href="#org1ad92b3">Postamble</a></h3>
<div class="outline-text-3" id="text-org1ad92b3">
<div class="org-src-container">
<pre class="src src-elisp">
(<span class="org-keyword">defvar</span> <span class="org-variable-name">general-postamble</span>
  <span class="org-string">"&lt;p class=\"footer\"&gt; Made with Emacs and Org.&lt;br&gt;CSS theme based on the one developed by &lt;a href=\"https://github.com/rougier\"&gt;@rougier&lt;/a&gt;.&lt;/p&gt;"</span>
  <span class="org-doc">"To be used on all pages."</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">comments-postamble</span>
  (concat
   <span class="org-string">"&lt;script src=\"https://giscus.app/client.js\" data-repo=\"chatziiola/chatziiola.github.io\" data-repo-id=\"R_kgDOGq8p0g\" data-category=\"Announcements\" data-category-id=\"DIC_kwDOGq8p0s4COSFW\" data-mapping=\"pathname\" data-reactions-enabled=\"1\" data-emit-metadata=\"0\" data-input-position=\"bottom\" data-theme=\"light\" data-lang=\"en\" data-loading=\"lazy\" crossorigin=\"anonymous\" async&gt; &lt;/script&gt;"</span>
   <span class="org-string">"&lt;p class=\"date footer\"&gt; Originally created on %d &lt;/p&gt;"</span>
   general-postamble)
  <span class="org-doc">"Postamble for posts so that giscus comments are enabled."</span>)

</pre>
</div>
</div>
</div>

<div id="outline-container-org9341af6" class="outline-3">
<h3 id="org9341af6"><a href="#org9341af6">Org-static-blog index variables</a></h3>
<div class="outline-text-3" id="text-org9341af6">
<p>
Being the person that I am, striving for simplicity and creating chaos to get
there, I have taken parts of this wonderful package <a href="https://github.com/bastibe/org-static-blog">org-static-blog</a>, and
butchered it to my needs
</p>

<div class="org-src-container">
<pre class="src src-elisp">
<span class="org-comment-delimiter">;;;; </span><span class="org-comment">These were set up on a need-to-set basis</span>
(<span class="org-keyword">setq</span> org-static-blog-enable-tags t)
(<span class="org-keyword">setq</span> org-static-blog-index-file <span class="org-string">"recents.html"</span>)
(<span class="org-keyword">setq</span> org-static-blog-index-front-matter <span class="org-string">""</span>)
(<span class="org-keyword">setq</span> org-static-blog-index-length 50)
(<span class="org-keyword">setq</span> org-static-blog-posts-directory <span class="org-string">"./content/posts/"</span>)
(<span class="org-keyword">setq</span> org-static-blog-page-postamble general-postamble)
(<span class="org-keyword">setq</span> org-static-blog-publish-directory <span class="org-string">"./public/posts/"</span>)
(<span class="org-keyword">setq</span> org-static-blog-publish-title <span class="org-string">"Recent Articles"</span>)
(<span class="org-keyword">setq</span> org-static-blog-publish-url <span class="org-string">"https://chatziiola.github.io"</span>)

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org9981630" class="outline-2">
<h2 id="org9981630"><a href="#org9981630">Package Settings&#xa0;&#xa0;&#xa0;<span class="tag"><span class="restructure">restructure</span></span></a></h2>
<div class="outline-text-2" id="text-org9981630">
<p>
These are pretty basic settings, only required in order for us to call a <i>clean</i>
emacs instance. A separate directory for packages is specified in order to not
liter our <b>actual</b> Emacs directory.
</p>

<p>
While one could avoid using extra packages ( as I have tried doing ) and keep it
as simple as possible, it is not smart to reinvent the wheel. If the desired
functionality is provided by a third party package, use it.
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">setq</span> make-backup-files nil
      auto-save-default nil
      create-lockfiles nil)

</pre>
</div>


<div class="org-src-container">
<pre class="src src-elisp">
(<span class="org-keyword">require</span> '<span class="org-constant">package</span>)
(<span class="org-keyword">setq</span> package-archives '((<span class="org-string">"melpa"</span> . <span class="org-string">"https://melpa.org/packages/"</span>)
                         (<span class="org-string">"elpa"</span> . <span class="org-string">"https://elpa.gnu.org/packages/"</span>)))

(<span class="org-keyword">setq</span> user-emacs-directory (expand-file-name <span class="org-string">"./.packages"</span>))
(<span class="org-keyword">setq</span> package-user-dir user-emacs-directory)

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Initialize the package system</span>
(package-initialize)
(<span class="org-keyword">unless</span> package-archive-contents
  (package-refresh-contents))

</pre>
</div>

<p>
Loading emacs does not mean that the publishing functions and variables have
already been loaded. The following lines ensures that we have successfully
loaded the actual publishing system
</p>
<div class="org-src-container">
<pre class="src src-elisp">
<span class="org-comment-delimiter">;; </span><span class="org-comment">Load the publishing system</span>
(<span class="org-keyword">require</span> '<span class="org-constant">ox-publish</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">ox-html</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">cl-extra</span>)

</pre>
</div>

<p>
Installing <code>use-package</code>
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Install dependencies</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">htmlize is needed for proper code formatting:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">https://stackoverflow.com/questions/24082430/org-mode-no-syntax-highlighting-in-exported-html-page</span>
(<span class="org-keyword">eval-when-compile</span>
  (add-to-list 'load-path (expand-file-name <span class="org-string">"use-package"</span> default-directory))
  (<span class="org-keyword">require</span> '<span class="org-constant">use-package</span>))

(<span class="org-keyword">use-package</span> <span class="org-constant">htmlize</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgede8ad2" class="outline-2">
<h2 id="orgede8ad2"><a href="#orgede8ad2">Org To Html Settings</a></h2>
<div class="outline-text-2" id="text-orgede8ad2">
<p>
These are settings that are used during the conversion of my org files
(articles) to html files. Under certain circumstances they can be overwritten
from the <code>org-projects-alist</code>&rsquo; options.
</p>


<div class="org-src-container">
<pre class="src src-elisp">
(<span class="org-keyword">setq</span> org-src-fontify-natively t)
(<span class="org-keyword">setq</span> org-html-htmlize-output-type 'css)

(<span class="org-keyword">setq</span> org-src-fontify-natively t                <span class="org-comment-delimiter">; </span><span class="org-comment">Fontify code in code blocks.</span>
      org-adapt-indentation nil                 <span class="org-comment-delimiter">; </span><span class="org-comment">Adaptive indentation</span>
      org-src-tab-acts-natively t               <span class="org-comment-delimiter">; </span><span class="org-comment">Tab acts as in source editing</span>
      org-confirm-babel-evaluate nil            <span class="org-comment-delimiter">; </span><span class="org-comment">No confirmation before executing code</span>
      org-edit-src-content-indentation 2        <span class="org-comment-delimiter">; </span><span class="org-comment">No relative indentation for code blocks</span>
      org-fontify-whole-block-delimiter-line t) <span class="org-comment-delimiter">; </span><span class="org-comment">Fontify whole block</span>


<span class="org-comment-delimiter">;; </span><span class="org-comment">Customize the HTML output</span>
(<span class="org-keyword">setq</span> org-html-validation-link nil
      org-html-head-include-scripts nil
      org-html-head-include-default-style nil
      org-html-indent nil
      org-html-self-link-headlines t
      org-export-with-tags t
      org-export-with-smart-quotes t
      org-html-head org-blog-head)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbec7727" class="outline-2">
<h2 id="orgbec7727"><a href="#orgbec7727">Babel</a></h2>
<div class="outline-text-2" id="text-orgbec7727">
<p>
Babel-related settings. I&rsquo;m pretty sure I had this enabled for a fancier feature
than simply highlighting but I&rsquo;m not 100% sure.
</p>

<div class="org-src-container">
<pre class="src src-elisp">
(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp . t)
   (gnuplot . t)
   (haskell . nil)
   (latex . t)
   (octave . t)
   (python . t)
   (matlab . t)
   (shell . t)
   (ruby . t)
   (sql . nil)
   (sqlite . t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda404c1" class="outline-2">
<h2 id="orgda404c1"><a href="#orgda404c1">Series next/before links&#xa0;&#xa0;&#xa0;<span class="tag"><span class="INACTIVE">INACTIVE</span></span></a></h2>
<div class="outline-text-2" id="text-orgda404c1">
<p>
This is a functionality that I long wanted to have implemented.  Now, although
this works perfectly, it creates a restriction: The files are chronologically
inserted in the previous/next &ldquo;queue&rdquo;. This means that in the case of lectures,
which I have irregularly published at times, there may be a slight confusion. To
avoid this causing a problem we must be careful with the dates in the filenames
of <i>forced</i> lectures.
</p>

<div class="org-src-container">
<pre class="src src-elisp" id="orgf73fe32">(<span class="org-keyword">defun</span> <span class="org-function-name">my-find-next-previous-series-article</span> (file)
  <span class="org-doc">"Find the filenames of the next and previous article, if they exist, in the same directory as FILE.</span>
<span class="org-doc">   This function acts only on lectures (files starting with 'lec_.) as of now.</span>
<span class="org-doc">The filenames are returned in HTML format."</span>
  (<span class="org-keyword">when</span> (string-prefix-p <span class="org-string">"lec_"</span> (file-name-nondirectory file))
    (<span class="org-keyword">let*</span> ((dir (file-name-directory file))
           (name (file-name-nondirectory file))
           (files (sort (directory-files dir nil <span class="org-string">"^lec_.*\\.org$"</span>) 'string&lt;))
           (index (cl-position name files <span class="org-builtin">:test</span> 'equal)))

        <span class="org-comment-delimiter">;; </span><span class="org-comment">This is a hack to ensure that the files get returned with the .html extension</span>
        (<span class="org-keyword">let</span> ((prev (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (&gt; index 0) (nth (1- index) files))
                             (concat (file-name-sans-extension (nth (1- index) files)) <span class="org-string">".html"</span>)))
              (next 
                    (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (&lt; index (1- (length files))) (nth (1+ index) files))
                        (concat (file-name-sans-extension (nth (1+ index) files)) <span class="org-string">".html"</span>))))
          (cons prev next))))
  )

</pre>
</div>

<p>
This function works really well the preceding one yet is not ideal. It inserts
the content at the end of the org mode buffer, causing problems with footnotes,
where they exist.
</p>
<div class="org-src-container">
<pre class="src src-elisp" id="org6202f08">(<span class="org-keyword">defun</span> <span class="org-function-name">my-add-links-to-next-previous-series-article</span> (backend)
  <span class="org-doc">"Add links to the previous and next series articles, if they exist."</span>
  (<span class="org-keyword">when</span> (org-export-derived-backend-p backend 'html)
    (<span class="org-keyword">let</span> ((prev-next (my-find-next-previous-series-article (buffer-file-name))))
      (<span class="org-keyword">when</span> prev-next
        (<span class="org-keyword">let</span> ((prev (car prev-next))
              (next (cdr prev-next)))
          (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> prev next)
            (goto-char (point-max))
            (forward-line 1)
            (insert <span class="org-string">"\n#+begin_export html\n"</span>)
            (insert <span class="org-string">"&lt;div class=\"series-navigation-div\"&gt;\n"</span>)
            (<span class="org-keyword">when</span> prev (insert (format <span class="org-string">"&lt;p&gt;&lt;a class=\"nav-button previous-nav-button\" href=\"%s\"&gt;Previous&lt;/a&gt;&lt;/p&gt;\n"</span> prev)))
            (<span class="org-keyword">when</span> next (insert (format <span class="org-string">"&lt;p&gt;&lt;a class=\"nav-button next-nav-button\" href=\"%s\"&gt;Next&lt;/a&gt;&lt;/p&gt;\n"</span> next)))
            (insert <span class="org-string">"&lt;/div&gt;\n"</span>)
            (insert <span class="org-string">"#+end_export"</span>)))))))

(add-hook 'org-export-before-parsing-hook 'my-add-links-to-next-previous-series-article)
</pre>
</div>


<p>
The perfect solution would be one like the preceding, the only problem with this
one is that it no longer works with the find-previous-next algorithm, since we
do not know which html files are created (only the previous one exists, the we
can not add a next button).
</p>
<div class="org-src-container">
<pre class="src src-elisp" id="org01e4723">
(<span class="org-keyword">defun</span> <span class="org-function-name">my-add-links-to-next-previous-series-article</span> ()
  <span class="org-doc">"Add links to the previous and next series  articles, if they exist."</span>
  (<span class="org-keyword">let</span> ((prev-next (my-find-next-previous-series-article (buffer-file-name))))
    (<span class="org-keyword">when</span> prev-next
      (<span class="org-keyword">let</span> ((prev (car prev-next))
            (next (cdr prev-next)))
        (goto-char (point-max))
        (<span class="org-keyword">unless</span> (re-search-backward <span class="org-string">"&lt;div id=\"postamble\""</span> nil t)
          (<span class="org-warning">error</span> <span class="org-string">"Could not find postamble div"</span>))
        (insert <span class="org-string">"\n&lt;div class=\"series-navigation-div\"&gt;\n"</span>)
        (<span class="org-keyword">when</span> prev (insert (format <span class="org-string">"&lt;p&gt;&lt;a class=\"nav-button previous-nav-button\" href=\"%s\"&gt;Previous&lt;/a&gt;&lt;/p&gt;\n"</span> prev)))
        (<span class="org-keyword">when</span> next (insert (format <span class="org-string">"&lt;p&gt;&lt;a class=\"nav-button next-nav-button\" href=\"%s\"&gt;Next&lt;/a&gt;&lt;/p&gt;\n"</span> next)))
        (insert <span class="org-string">"&lt;/div&gt;\n"</span>)
        ))))

(add-hook 'org-export-after-parsing-hook #'my-add-links-to-next-previous-series-article)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1ca1da" class="outline-2">
<h2 id="orgd1ca1da"><a href="#orgd1ca1da">Tips:</a></h2>
<div class="outline-text-2" id="text-orgd1ca1da">
<p>
One could use relative paths (even though I now (<span class="timestamp-wrapper"><span class="timestamp">&lt;2023-01-01 Sun&gt;</span></span>) find some
problems with this approach, as it breaks some stuff when creating index pages),
to ensure that no faulty links exist.
</p>
</div>
</div>

<div id="outline-container-org596701f" class="outline-2">
<h2 id="org596701f"><a href="#org596701f">Project Alist</a></h2>
<div class="outline-text-2" id="text-org596701f">
<p>
Org publishing works with projects, a fancy way to call files and directories.
</p>

<p>
There are four projects, with different variables and settings:
</p>
<ol class="org-ol">
<li><a href="#orgbe9b6f3">Org-files</a>, all org files in my <code>/content</code> folder</li>
<li><a href="#orgfafc83e">Blog-posts</a>, all org files in my <code>/content/posts</code> folder</li>
<li><a href="#orgf461f45">Images</a>, images in <code>/content/images</code></li>
<li><a href="#orgd41e81a">Static</a>, html and css files in <code>/content/src</code></li>
</ol>

<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">setq</span> org-publish-project-alist
      (list
</pre>
</div>
</div>

<div id="outline-container-org0f03d6f" class="outline-4">
<h4 id="org0f03d6f"><a href="#org0f03d6f">The Brief</a></h4>
<div class="outline-text-4" id="text-org0f03d6f">
<p>
The <code>org</code> mode files ( the articles ) exist in the <code>/contents/</code> folder, which is
where I&rsquo;m working. We want to automate the process of converting these files to
html and moving this web-friendly version to the <code>/public</code> directory, which is
the root directory of our web server.
</p>

<p>
To achieve that we first convert all org mode files
</p>
</div>
</div>
<div id="outline-container-org661521e" class="outline-4">
<h4 id="org661521e"><a href="#org661521e">Summing up</a></h4>
<div class="outline-text-4" id="text-org661521e">
<ol class="org-ol">
<li>Order is crucial, since the export is sequential and the later exports may
overwrite previous ones.</li>
</ol>
</div>
</div>

<div id="outline-container-orgbe9b6f3" class="outline-3">
<h3 id="orgbe9b6f3"><a href="#orgbe9b6f3">Org-files</a></h3>
<div class="outline-text-3" id="text-orgbe9b6f3">
<div class="org-src-container">
<pre class="src src-elisp">(list <span class="org-string">"org-files"</span>
</pre>
</div>

<p>
It contains all files in <code>/content/</code> except for my draft articles. ( It should
work like that, however drafts are currently being exported&#x2026; Maybe someone
notices the error here and proposes a solution in the comments )
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:base-directory</span> base-dir
<span class="org-builtin">:base-extension</span> <span class="org-string">"org"</span>
<span class="org-builtin">:exclude</span> drafts-dir
</pre>
</div>


<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:recursive</span> t
</pre>
</div>


<p>
Kinda general, the publishing function and where to publish
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:html-link-home</span> <span class="org-string">"/index.html"</span>
<span class="org-builtin">:html-link-up</span> <span class="org-string">"../index.html"</span>
<span class="org-builtin">:html-postamble</span> general-postamble
<span class="org-builtin">:publishing-directory</span> public-dir
<span class="org-builtin">:publishing-function</span> 'org-html-publish-to-html
</pre>
</div>

<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:with-author</span> nil           <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't include author name</span>
<span class="org-builtin">:with-creator</span> nil            <span class="org-comment-delimiter">;; </span><span class="org-comment">Include Emacs and Org versions in footer</span>
<span class="org-builtin">:with-drawers</span> t
<span class="org-builtin">:headline-level</span> 4
</pre>
</div>

<p>
Table of contents has been taken <i>offline</i> due to the fact that I did not
like how it looked.
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:with-toc</span> nil
</pre>
</div>


<p>
Section numbers do not work with my <code>css</code> since it provides numbering.
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:section-numbers</span> nil       <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't include section numbers</span>
</pre>
</div>

<p>
This is a setting that gets overwritten for blog posts but it essentially
makes the home button to point to the home page of my website and the up
button to go a directory higher.
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:html-link-home</span> <span class="org-string">"/index.html"</span>
<span class="org-builtin">:html-link-up</span> <span class="org-string">"../index.html"</span>
</pre>
</div>

<p>
This could be a rather useful entry, if there was maybe an integration
with version control so that files would only get published if the had
been edited. The problem is that it makes all posts have the same date
and that does not look nice. A better way to deal with this problem is
the <code>#+DATE:</code> header at the top of blog posts.
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:time-stamp-file</span> nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfafc83e" class="outline-3">
<h3 id="orgfafc83e"><a href="#orgfafc83e">Blog-posts</a></h3>
<div class="outline-text-3" id="text-orgfafc83e">
<div class="org-src-container">
<pre class="src src-elisp">(list <span class="org-string">"blog-posts"</span>
</pre>
</div>

<p>
This is crucial.
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:base-directory</span> posts-dir
<span class="org-builtin">:base-extension</span> <span class="org-string">"org"</span>
<span class="org-builtin">:exclude</span> <span class="org-string">".*index.org"</span>
</pre>
</div>

<p>
Recursive once again
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:recursive</span> t
</pre>
</div>

<p>
Another difference
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:html-link-up</span> <span class="org-string">"./index.html"</span>
<span class="org-builtin">:html-link-home</span> <span class="org-string">"/index.html"</span>
</pre>
</div>

<p>
Yup, I decided against that
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-comment-delimiter">;     </span><span class="org-comment">:auto-sitemap t</span>
<span class="org-comment-delimiter">;     </span><span class="org-comment">:sitemap-filename "sitemap.org"</span>
<span class="org-comment-delimiter">;     </span><span class="org-comment">:sitemap-title "Sitemap"</span>
<span class="org-comment-delimiter">;     </span><span class="org-comment">:sitemap-sort-files 'anti-chronologically</span>
<span class="org-comment-delimiter">;     </span><span class="org-comment">:sitemap-date-format "Published: %a %b %d %Y"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:html-postamble</span>  comments-postamble
<span class="org-builtin">:publishing-directory</span> posts-public-dir
<span class="org-builtin">:publishing-function</span> 'org-html-publish-to-html
</pre>
</div>

<p>
The following settings actually do not need further explanation
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-builtin">:with-author</span> t           <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't include author name</span>
<span class="org-builtin">:with-creator</span> t            <span class="org-comment-delimiter">;; </span><span class="org-comment">Include Emacs and Org versions in footer</span>
<span class="org-builtin">:with-drawers</span> t
<span class="org-builtin">:with-date</span> t
<span class="org-builtin">:headline-level</span> 4
<span class="org-builtin">:with-toc</span> t                <span class="org-comment-delimiter">;; </span><span class="org-comment">Include a table of contents</span>
<span class="org-builtin">:section-numbers</span> nil       <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't include section numbers</span>
<span class="org-builtin">:time-stamp-file</span> nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf461f45" class="outline-3">
<h3 id="orgf461f45"><a href="#orgf461f45">Images</a></h3>
<div class="outline-text-3" id="text-orgf461f45">
<p>
You may have already noticed that the two previous projects contain only my org
files, even though a website is so much more than html ( to which org will get
converted ). There are other types of media, such as images and css elements. In
order to get these published ( contained in <code>/content/images</code> and <code>/content/src</code>
respectively) we use the <code>org-publish-attachment</code> function, which essentially
copies the specified files to the target directory
</p>

<div class="org-src-container">
<pre class="src src-elisp">(list <span class="org-string">"Images"</span>
      <span class="org-builtin">:base-directory</span> posts-dir
      <span class="org-builtin">:base-extension</span> <span class="org-string">"png"</span>
      <span class="org-builtin">:publishing-directory</span> posts-public-dir
      <span class="org-builtin">:publishing-function</span> 'org-blog-publish-attachment
      <span class="org-builtin">:recursive</span> t
      )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd41e81a" class="outline-3">
<h3 id="orgd41e81a"><a href="#orgd41e81a">Static</a></h3>
<div class="outline-text-3" id="text-orgd41e81a">
<div class="org-src-container">
<pre class="src src-elisp">(list <span class="org-string">"Website static stuff"</span>
      <span class="org-builtin">:base-directory</span> src-dir
      <span class="org-builtin">:base-extension</span> <span class="org-string">"html</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">css</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">ico"</span>
      <span class="org-builtin">:publishing-directory</span> src-public-dir
      <span class="org-builtin">:publishing-function</span> 'org-publish-attachment
      <span class="org-builtin">:recursive</span> t
      )
)
)



</pre>
</div>

<p>
And another function to help with images
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Automatic image conversion</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">org-blog-publish-attachment</span> (plist filename pub-dir)
  <span class="org-doc">"Publish a file with no transformation of any kind.</span>
<span class="org-doc">FILENAME is the filename of the Org file to be published.  PLIST</span>
<span class="org-doc">is the property list for the given project.  PUB-DIR is the</span>
<span class="org-doc">publishing directory.</span>
<span class="org-doc">Take care of minimizing the pictures using imagemagick.</span>
<span class="org-doc">Return output file name."</span>
  (<span class="org-keyword">unless</span> (file-directory-p pub-dir)
    (make-directory pub-dir t))
  (<span class="org-keyword">or</span> (equal (expand-file-name (file-name-directory filename))
             (file-name-as-directory (expand-file-name pub-dir)))
      (<span class="org-keyword">let</span> ((dst-file (expand-file-name (file-name-nondirectory filename) pub-dir)))
        (<span class="org-keyword">if</span> (string-match-p <span class="org-string">".*\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">png</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">jpg</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">gif</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span> filename)
            (shell-command (format <span class="org-string">"convert %s -resize 800x800\\&gt; +dither -colors 16 -depth 4 %s"</span> filename dst-file))
          (copy-file filename dst-file t)))))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org15468c6" class="outline-2">
<h2 id="org15468c6"><a href="#org15468c6">The End - Taking Action</a></h2>
<div class="outline-text-2" id="text-org15468c6">
<div class="org-src-container">
<pre class="src src-elisp">
(org-publish-all t)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9732e4" class="outline-2">
<h2 id="orgd9732e4"><a href="#orgd9732e4">Org-static-blog for index creation</a></h2>
<div class="outline-text-2" id="text-orgd9732e4">
<p>
I tried removing this section, but in great terror I realized how
naive I was when I wrote this. It needs the variables that I set in
here.
</p>

<div class="org-src-container">
<pre class="src src-elisp">
(load (expand-file-name <span class="org-string">"index-generator.el"</span> default-directory))
(chatziiola/org-static-blog-assemble-index-no-content)

<span class="org-comment-delimiter">;;; </span><span class="org-comment">build-site.el ends here.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a2bf19" class="outline-2">
<h2 id="org0a2bf19"><a href="#org0a2bf19">Sources of inspiration</a></h2>
<div class="outline-text-2" id="text-org0a2bf19">
<p>
This is intended to be the last section of my literate config file. It is
devoted to all the websites that inspired me to take action towards improving my
site:
</p>
<ul class="org-ul">
<li><a href="https://her.esy.fun/posts/0001-new-blog/index.html">https://her.esy.fun/posts/0001-new-blog/index.html</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<script src="https://giscus.app/client.js" data-repo="chatziiola/chatziiola.github.io" data-repo-id="R_kgDOGq8p0g" data-category="Announcements" data-category-id="DIC_kwDOGq8p0s4COSFW" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async> </script><p class="date footer"> Originally created on 2022-07-09 Sat 00:00 </p><p class="footer"> Made with Emacs and Org.<br>CSS theme based on the one developed by <a href="https://github.com/rougier">@rougier</a>.</p>
</div>
</body>
</html>
