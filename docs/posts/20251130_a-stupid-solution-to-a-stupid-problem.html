<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A stupid solution to a stupid problem</title>
<meta name="author" content="Lamprinos Chatziioannou" />
<meta name="description" content="Learn how to create a robust and flexible draft management system for your Org-mode blog. This guide walks you through customizing the org-publish process with Emacs Lisp functions to gain full control over which posts are published and which remain as drafts." />
<meta name="generator" content="Org Mode" />
<link rel="preconnect" href="https://fonts.googleapis.com"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/gh/oyvindstegard/ox-tagfilter-js/ox-tagfilter.js"></script> <link rel="stylesheet" href="/src/rougier.min.css" /> <script src="/src/copy-pre.min.js"></script> <script src="/src/theme-switcher.min.js" defer></script> <link rel="icon" type="image/x-icon" href="/src/favicon.ico"> <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-55X4GXWBKS"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-55X4GXWBKS'); </script><script src="https://kit.fontawesome.com/78d5a086dd.js" crossorigin="anonymous"></script>
</head>
<body>
<div id="preamble" class="status">
<div id="org-div-home-and-up"><a accesskey="H" href="/index.html"> HOME </a> | <button id="theme-toggle" title="Toggle theme">ðŸŒ“</button></div>
</div>
<div id="content" class="content">
<h1 class="title">A stupid solution to a stupid problem
<br>
<span class="subtitle">Customizing Your Org-Publish Workflow for Draft Posts</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org18e1998">Introduction</a></li>
<li><a href="#orgc2c8686">Current workflow</a></li>
<li><a href="#org1180fc0">Bypassing the problem</a></li>
<li><a href="#org1e82039">My index publication function</a></li>
<li><a href="#orgfd49aad">Working with draft articles</a></li>
<li><a href="#orgaadb46b">Summary</a></li>
</ul>
</div>
</div>
<div id="outline-container-org18e1998" class="outline-2">
<h2 id="org18e1998"><a href="#org18e1998">Introduction</a></h2>
<div class="outline-text-2" id="text-org18e1998">
<p>
I haven&rsquo;t published any articles for quite a long time. Usually, when that
happens, it&rsquo;s either because I didn&rsquo;t want to write about anything, or I didn&rsquo;t
have the time.
</p>

<p>
God knows I haven&rsquo;t had much time these past months (and won&rsquo;t have
as much as one would like moving forward), but I&rsquo;ve put in work on quite a few
projects I was excited to write about. And I wrote, because I had made
it easy for myself â€“ just pressing `~&lt;spc&gt;la~` in Emacs creates a properly named and
formatted article. I needed nothing more.
</p>
</div>
</div>
<div id="outline-container-orgc2c8686" class="outline-2">
<h2 id="orgc2c8686"><a href="#orgc2c8686">Current workflow</a></h2>
<div class="outline-text-2" id="text-orgc2c8686">
<p>
But if that&rsquo;s all&#x2026; why didn&rsquo;t I publish? Because I hadn&rsquo;t made it easy for publishing. In
fact, the process of publishing an article remains quite cumbersome. For instance, if I create
article A but don&rsquo;t publish (or even fully write) it before completing article B, it messes things up:
</p>
<ol class="org-ol">
<li>It gets published in Org mode.</li>
<li>It gets added by Python to my index files (both the generic archive, the tags index, and the latest articles).</li>
</ol>
<p>
And I don&rsquo;t want to start &ldquo;deleting&rdquo; content I don&rsquo;t want to publish.
</p>

<div class="note" id="org682c678">
<p>
An obvious solution is to keep my draft files in a directory separate from where they&rsquo;ll be published. I tried that once, but without elaborating, it presented its own set of problems.
</p>

</div>
</div>
</div>
<div id="outline-container-org1180fc0" class="outline-2">
<h2 id="org1180fc0"><a href="#org1180fc0">Bypassing the problem</a></h2>
<div class="outline-text-2" id="text-org1180fc0">
<p>
If you&rsquo;ve read the Org documentation on publishing (for instance, the <a href="https://orgmode.org/manual/Selecting-files.html">Selecting files
section</a>), and then proceeded to tinker with your own configuration, you might
have realized that exclusions are a tricky thing.
</p>

<p>
It&rsquo;s a truly frustrating problem. Wanting to simply exclude a file<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>, yet somehow your
`:exclude-tags &rsquo;(&ldquo;draft&rdquo; &ldquo;noexport&rdquo; &ldquo;nopublish&rdquo;)` becomes another bystander. What
if&#x2026; I exclude the files I want by replacing the publishing function?
</p>
</div>
</div>
<div id="outline-container-org1e82039" class="outline-2">
<h2 id="org1e82039"><a href="#org1e82039">My index publication function</a></h2>
<div class="outline-text-2" id="text-org1e82039">
<p>
Aptly named `my-selective-publish`, this function came to me while working on a
wholly different project, yet I wanted to test it. And it worked!
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-selective-publish</span> (plist filename pub-dir)
  <span class="org-doc">"Publish FILENAME only if it is an index.org file."</span>
  (<span class="org-keyword">when</span> (string-equal <span class="org-string">"index.org"</span> (file-name-nondirectory filename))
    (org-html-publish-to-html plist filename pub-dir)))
</pre>
</div>

<p>
Instead of specifying `org-html-publish-to-html` as the publishing function
directly, I simply replaced it with `my-selective-publish`. It ignores
everything except the `index.org` files.
</p>
<div class="org-src-container">
<pre class="src src-elisp">
(<span class="org-keyword">setq</span> org-publish-project-alist
      (list

       (list <span class="org-string">"indices"</span>
             <span class="org-builtin">:base-directory</span> base-dir
             <span class="org-builtin">:recursive</span> t
             <span class="org-builtin">:html-postamble</span> general-postamble
             <span class="org-builtin">:publishing-directory</span> public-dir
             <span class="org-builtin">:publishing-function</span> 'my-selective-publish
             <span class="org-builtin">:with-author</span> nil           <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't include author name</span>
             <span class="org-builtin">:with-creator</span> nil            <span class="org-comment-delimiter">;; </span><span class="org-comment">Include Emacs and Org versions in footer</span>
             <span class="org-builtin">:with-drawers</span> t
             <span class="org-builtin">:headline-level</span> 4
             <span class="org-builtin">:with-toc</span> nil
             <span class="org-builtin">:section-numbers</span> nil       <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't include section numbers</span>
             <span class="org-builtin">:time-stamp-file</span> nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd49aad" class="outline-2">
<h2 id="orgfd49aad"><a href="#orgfd49aad">Working with draft articles</a></h2>
<div class="outline-text-2" id="text-orgfd49aad">
<p>
At this point, one might ask: &ldquo;Great, but how is that helpful?&rdquo; The thing is,
since this works, we can &rsquo;hack&rsquo; our way through: I can easily add a line
like `#+DRAFT: t` to my draft articles, and I&rsquo;m pretty sure you know where this
is going. Since I can both add such a line (automatically) to all articles I
haven&rsquo;t yet published<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup> and search for this line, I can create a wrapper
function based on that:
</p>
<div class="org-src-container">
<pre class="src src-elisp" id="org47b745a">(<span class="org-keyword">defun</span> <span class="org-function-name">my-publish-non-drafts</span> (plist filename pub-dir)
  <span class="org-doc">"Publish FILENAME only if it does not have a DRAFT property set to t."</span>
  (<span class="org-keyword">when</span> (not (string-equal <span class="org-string">"index.org"</span> (file-name-nondirectory filename)))
    (<span class="org-keyword">with-temp-buffer</span>
      (insert-file-contents filename)
      (goto-char (point-min))
      (<span class="org-keyword">let</span> ((is-draft (re-search-forward <span class="org-string">"^#\\+DRAFT:\\s-*t"</span> nil t)))
        (<span class="org-keyword">unless</span> is-draft
          (org-html-publish-to-html plist filename pub-dir))))))
</pre>
</div>

<p>
I would never characterize this function as elegant. <b>BUT</b> it gets the work done, and
that&rsquo;s all that matters. Some years after migrating to `org+emacs+allmyhacks` for
my blog, I now have a default &rsquo;draft&rsquo; state on all of my articles.
</p>
</div>
</div>
<div id="outline-container-orgaadb46b" class="outline-2">
<h2 id="orgaadb46b"><a href="#orgaadb46b">Summary</a></h2>
<div class="outline-text-2" id="text-orgaadb46b">
<p>
Well, this is it: the stupid solution
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
Or many of those
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<b>and</b> to all new articles upon creation
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<script src="https://giscus.app/client.js" data-repo="chatziiola/chatziiola.github.io" data-repo-id=x\"R_kgDOGq8p0g" data-category="Announcements" data-category-id="DIC_kwDOGq8p0s4COSFW" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async> </script> <p class=\"date footer\"> Originally created on 2025-11-30 Sun 21:23</p><p class="footer"> Made with Emacs and Org.<br>CSS theme based on the one developed by <a href="https://github.com/rougier">@rougier</a>.<br> <a href="https://github.com/chatziiola"> <i class="fa-brands fa-github"></i> </a> <a href="https://www.linkedin.com/in/chatziiola"> <i class="fa-brands fa-linkedin"></i> </a> </p>
</div>
</body>
</html>
